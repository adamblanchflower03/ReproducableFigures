---
title: "QUESTION 02: Data Pipeline"
output: html_document
date: "2024-11-26"
---

INTRODUCTION

"Sexual dimorphism" means that the two sexes of a species differ in external appearances or other features (Ralls & Mesnich., 2009). This includes differences in size, where one of the sexes are considerably larger than the other. In this study, I investigate whether this sexual size dimorphism is apparent in the Gentoo penguin (Pygoscelis papua) using body mass data acquired from the "palmerpenguins" data set. If there was no size difference, we would expect the coefficient from a linear model analysis to be zero. If there was a size difference, we would expect the coefficient from a linear model analysis to be significantly different form zero.


STATISTICAL METHODS

Loading libraries

```{r}
library(tidyverse)
library(palmerpenguins)
library(janitor)
library(here)
library(ragg)
library(svglite)
library(broom)
```


Loading functions

```{r}
#Cleaning function file
source(here("functions", "cleaning.R"))

#Function file to save figures as .png and .svg files
source(here("functions", "png_and_svg_functions.R"))

#Functions to produce exploratory figures 
source(here("functions", "exploratory_figure_functions.R"))

#Linear model figure function
source(here("functions", "linear_model_figure.R"))

#Diagnostic plot function
source(here("functions", "diagnostic_plot_function.R"))
```


Loading the data

```{r}
#Loading raw dataset
penguins_raw

#Saving raw dataset
write_csv(penguins_raw, here("data", "penguins_raw.csv"))
```


Cleaning and subsetting the data

```{r}
#Clean and subset the data. Filter by Gentoo species and subset species, body mass and sex
clean_gentoo_body_mass_sex <- penguins_clean %>%
  filter(species == "Gentoo") %>%   
  select(species, body_mass_g, sex) %>%  
  remove_NA() 

#visualise the data 
head(clean_gentoo_body_mass_sex)

#save cleaned data set
write_csv(clean_gentoo_body_mass_sex, here("data", "clean_gentoo_body_mass.csv"))
```


Creating an Exploratory Figure - Histogram

I first visualized the differences in body mass between the sexes using a histogram. The histogram suggests that the modal body mass of male Gentoo penguins is approximately 250 grams heavier than females, while the mass range appears similar for both sexes, around 1500 grams. Aside from two male outliers and one female outlier, the body mass data seems to exhibit little skew and appears approximately normally distributed. This suggests that a linear model would be an appropriate statistical test to compare body mass differences between the sexes.

```{r}
#Histogram function
histogram <- overlapping_histogram_comparing_sexes(clean_gentoo_body_mass_sex, body_mass_g, sex, "Body Mass(g)", "Count")

#Visualising histogram 
histogram


#Saving histogram as .png 
save_as_png(clean_gentoo_body_mass_sex, 
            here("figures", "histogram.png"), 
            histogram,
            size = 20, res = 300, scaling = 2)


#Saving histogram as .svg
save_as_svg(clean_gentoo_body_mass_sex,
            here("figures", "histogram.svg"),
            histogram,
            size = 20, scaling = 2)
```


Defining the linear model 

```{r}
#Defining linear model
linear_model <- lm(body_mass_g ~ sex, data = clean_gentoo_body_mass_sex)
```


Checking for assumptions of linear model analysis 

Before conducting the linear model analysis, it is essential to verify that the data meets the assumptions of: 1) independence, 2) normality, 3) homoscedasticity, and 4) absence of influential outliers. Although I lack information on the data collection methods, I assume that the data points are independent of each other. To check for the remaining assumptions, I examined diagnostic plots displayed in a multi-panel grid. The Q-Q residuals plot indicates that the residuals are normally distributed, as the data points closely follow the straight line. The residuals versus fitted values and scale-location plots show random scatter and a horizontal line, suggesting homoscedasticity. Finally, the residuals versus leverage plot indicates that the outliers identified in the histogram have a small Cook's distance, implying they are not influential.

```{r}
#Diagnostic plots 
#Displaying diagnostic plots in a multi-panel grid and adjusting margin size 
par(mfrow = c(2, 2), 
    mar = c(4, 4, 2, 2))  


#Diagnostic plot function
diagnostic_plot_function()


# Saving the diagnostic plot as a .png
save_diagnostic_plot_as_png(
  here("figures", "diagnostic_plot.png"),  
  diagnostic_plot_function,                    
  size = 20,                               
  res = 300,                              
  scaling = 2                              
)

# Saving the diagnostic plot as a .svg
save_diagnostic_plot_as_svg(
  here("figures", "diagnostic_plot.svg"),  
  diagnostic_plot_function,                    
  size = 20,                               
  scaling = 2                              
)
```


RESULTS

Given that all the assumptions for the linear model were met, I proceeded with the linear model analysis. The results from the linear model show that male Gentoo penguins are, on average, 805.09 grams heavier than females. This difference is statistically significant (p < 0.05). Additionally, the multiple R-squared value of 0.6494 suggests that sex explains a substantial portion of the variance in body mass, though other factors likely contribute as well..  

```{r}
#Linear model analysis 
summary(linear_model)
```


```{r}
#Linear model analysis summary table
#Firstly, converting model into a clean structure and extracting key details 
linear_model_summary <- tidy(linear_model)   

#Summary table - estimate, SE, and statistic rounded to three decimal points and p-values to 4 significant figures  
linear_model_summary_table <- linear_model_summary %>%
  select(term, estimate, std.error, statistic, p.value) %>%
  mutate(    
    estimate = round(estimate, 3),
    std.error = round(std.error, 3),
    statistic = round(statistic, 3),
    p.value = format(p.value, scientific = TRUE, digits = 4)) 

print(linear_model_summary_table)
```


```{r}
#Results figure function
linear_model_results_figure <-linear_model_figure(clean_gentoo_body_mass_sex, sex, body_mass_g, "Sex", "Body Mass (g)")

linear_model_results_figure

#Saving results figure as .png 
save_as_png(clean_gentoo_body_mass_sex, 
            here("figures", "results_figure.png"), 
            linear_model_results_figure,
            size = 20, res = 300, scaling = 2)


#Saving results figure as .svg
save_as_svg(clean_gentoo_body_mass_sex,
            here("figures", "results_figure.svg"),
            linear_model_results_figure,
            size = 20, scaling = 2)
```

DISCUSSION


CONCLUSION



QUESTION 3: Open Science
