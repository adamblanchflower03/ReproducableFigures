---
title: "QUESTION 02: Data Pipeline"
output: html_document
date: "2024-11-26"
---

INTRODUCTION

"Sexual dimorphism" means that the two sexes of a species differ in external appearances or other features (Ralls & Mesnich., 2009). This includes differences in size, where one of the sexes are considerably larger than the other. In this study, I investigate whether this sexual size dimorphism is apparent in the Gentoo penguin (Pygoscelis papua) using body mass data acquired from the "palmerpenguins" data set. If there was no size difference, we would expect the coefficient from a linear model analysis to be zero. If there was a size difference, we would expect the coefficient from a linear model analysis to be significantly different form zero.


STATISTICAL METHODS

Loading libraries

```{r}
library(tidyverse)
library(palmerpenguins)
library(janitor)
library(here)
library(ragg)
library(svglite)
library(broom)
```


Loading functions

```{r}
#Cleaning function file
source(here("functions", "cleaning.R"))

#Function file to save figures as .png and .svg files
source(here("functions", "png_and_svg_functions.R"))

#Functions to produce exploratory figures 
source(here("functions", "exploratory_figure_functions.R"))

#Linear model figure function
source(here("functions", "linear_model_figure.R"))

#Diagnostic plot function
source(here("functions", "diagnostic_plot_function.R"))
```


Loading the data

```{r}
#Loading raw data set
penguins_raw

#Saving raw data set
write_csv(penguins_raw, here("data", "penguins_raw.csv"))
```


Cleaning and subsetting the data

```{r}
#Clean and subset the data. Filter by Gentoo species and subset species, body mass and sex
clean_gentoo_body_mass_sex <- penguins_clean %>%
  filter(species == "Gentoo") %>%   
  select(species, body_mass_g, sex) %>%  
  remove_NA() 

#visualise the data 
head(clean_gentoo_body_mass_sex)

#save cleaned data set
write_csv(clean_gentoo_body_mass_sex, here("data", "clean_gentoo_body_mass.csv"))
```


Creating an Exploratory Figure - Histogram

I first visualized the differences in body mass between the sexes using a histogram. The histogram suggests that the modal body mass of male Gentoo penguins is approximately 250 grams heavier than females, while the mass range appears similar for both sexes, around 1500 grams. Aside from two male outliers and one female outlier, the body mass data seems to exhibit little skew and appears approximately normally distributed. This suggests that a linear model would be an appropriate statistical test to compare body mass differences between the sexes.

```{r}
#Histogram function
histogram <- overlapping_histogram_comparing_sexes(clean_gentoo_body_mass_sex, body_mass_g, sex, "Body Mass(g)", "Count")

#Visualising histogram 
histogram


#Saving histogram as .png 
save_as_png(clean_gentoo_body_mass_sex, 
            here("figures", "histogram.png"), 
            histogram,
            size = 20, res = 300, scaling = 2)


#Saving histogram as .svg
save_as_svg(clean_gentoo_body_mass_sex,
            here("figures", "histogram.svg"),
            histogram,
            size = 20, scaling = 2)
```


Defining the linear model 

```{r}
#Defining linear model
linear_model <- lm(body_mass_g ~ sex, data = clean_gentoo_body_mass_sex)
```


Checking for assumptions of linear model analysis 

Before conducting the linear model analysis, it is essential to verify that the data meets the assumptions of: 1) independence, 2) normality, 3) homoscedasticity, and 4) absence of influential outliers. Although I lack information on the data collection methods, I assume that the data points are independent of each other. To check for the remaining assumptions, I examined diagnostic plots displayed in a multi-panel grid. The Q-Q residuals plot indicates that the residuals are normally distributed, as the data points closely follow the straight line. The residuals versus fitted values and scale-location plots show random scatter and a horizontal line, suggesting homoscedasticity. Finally, the residuals versus leverage plot indicates that the outliers identified in the histogram have a small Cook's distance, implying they are not influential.

```{r}
#Diagnostic plots 
#Displaying diagnostic plots in a multi-panel grid and adjusting margin size 
par(mfrow = c(2, 2), 
    mar = c(4, 4, 2, 2))  


#Diagnostic plot function
diagnostic_plot_function()


# Saving the diagnostic plot as a .png
save_diagnostic_plot_as_png(
  here("figures", "diagnostic_plot.png"),  
  diagnostic_plot_function,                    
  size = 20,                               
  res = 300,                              
  scaling = 2                              
)

# Saving the diagnostic plot as a .svg
save_diagnostic_plot_as_svg(
  here("figures", "diagnostic_plot.svg"),  
  diagnostic_plot_function,                    
  size = 20,                               
  scaling = 2                              
)
```


RESULTS

Given that all the assumptions for the linear model were met, I proceeded with the linear model analysis. The results from the linear model show that male Gentoo penguins are, on average, 805.09 grams heavier than females. This difference is statistically significant (p < 0.05). Additionally, the multiple R-squared value of 0.6494 suggests that sex explains a substantial portion of the variance in body mass, though other factors likely contribute as well. 

```{r}
#Linear model analysis 
summary(linear_model)
```


```{r}
#Linear model analysis summary table
#Firstly, converting model into a clean structure and extracting key details 
linear_model_summary <- tidy(linear_model)   

#Summary table - estimate, SE, and statistic rounded to three decimal points and p-values to 4 significant figures  
linear_model_summary_table <- linear_model_summary %>%
  select(term, estimate, std.error, statistic, p.value) %>%
  mutate(    
    estimate = round(estimate, 3),
    std.error = round(std.error, 3),
    statistic = round(statistic, 3),
    p.value = format(p.value, scientific = TRUE, digits = 4)) 

print(linear_model_summary_table)
```


```{r}
#Results figure function
linear_model_results_figure <-linear_model_figure(clean_gentoo_body_mass_sex, sex, body_mass_g, "Sex", "Body Mass (g)")

linear_model_results_figure

#Saving results figure as .png 
save_as_png(clean_gentoo_body_mass_sex, 
            here("figures", "results_figure.png"), 
            linear_model_results_figure,
            size = 20, res = 300, scaling = 2)


#Saving results figure as .svg
save_as_svg(clean_gentoo_body_mass_sex,
            here("figures", "results_figure.svg"),
            linear_model_results_figure,
            size = 20, scaling = 2)
```

DISCUSSION

In this study, I examined whether sexual size dimorphism is present in Gentoo penguins by analysing body mass data from the palmerpenguins data set. The results from the linear model analysis that I carried out after verifying it's assumptions indicate a significant difference in body mass between male and female Gentoo penguins. On average, the males were 805.09 grams heavier. Therefore this result supports the hypothesis that sexual dimorphism is present in this species

This size difference is consistent with other studies looking at different penguin species (Poisbleau et al., 2010; Koehn et al., 2016). Furthermore, the large multiple R-squared value (0.6494) suggests that sex is an important factor in determining the body mass in Gentoo penguins. However, it is important to note that other variables, such as food availability, determining body mass have not been accounted for. Hence, future studies could include additional covariates to better explain the variabilitiy in body mass. 

Another potential area for future research could be to explore the potential reasons behind this sexual size dimorphism. For example, the breeding ecology of these penguins could mean that males are better competitors for mating opportunities when they have a larger body mass. As a result, sexual selection over evolutionary time may have selected for males to have a larger body size in this species. Investigating the relationship between body mass and a potential behavioural traits as just described could provide additional insights into the evolutionary pressures that shape size dimorphism in this species.

Finally it is important to note that although the linear model met most of the necessary assumptions there is still the main limitation that I have presumed independence even though the data could have been collected in a way that could introduce biases between individual measurements.


CONCLUSION

This study confirms the presence of sexual size dimorphism in the Gentoo penguin species, where males are significantly larger than females by an average of 805.09 grams. The linear model analysis shown that this variation was largely explained by sex with a high multiple R-squared value (0.6494) but it should be noted that other factors not considered in this study will affect body mass. Whilst most of the assumptions for the linear model were met, independence had to be presumed based off the lack of knowledge on the methodology carried out to obtain body mass measurements for the different sexes. This is therefore a key limitation of the study. Future research should incorporate other covariates that would affect body size, such as food availability, as well as looking at the evolutionary drivers of sexual size dimorphism in this species. Overall, this study provides evidence for the presence of sexual size dimorphism in the Gentoo penguin species.


REFERENCES

Koehn, L.E., Hard, J.J., Akst, E.P., Boersma, D.P. (2016). Natural selection on morphology varies among years and by sex in Magellanic Penguins (Spheniscus magellanicus), The Auk, 133(4): pp 783-805. https://doi.org/10.1642/AUK-16-50.1 

Poisbleau, M., Demongin, L., van Noordwijk, H.J., Strange, I.J., Quillfeldt, P. (2010). Sexual Dimorphism and use of Morphological Measurements to Sex Adults, Immatures and Chicks of Rockhopper Penguins, Ardea, 98(2): pp 217-224. https://doi.org/10.5253/078.098.0212 

Ralls, K., Mesnick, S. (2009) Sexual Dimorphism, Enclyclopedia of Marine Mammals, pp 1005-1011. http://dx.doi.org/10.1016/B978-0-12-373553-9.00233-9 

QUESTION 3: Open Science
